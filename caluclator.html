<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator App</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .calculator-container {
            max-width: 400px;
            margin: 50px auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .calculator-container:hover {
            transform: translateY(-5px);
        }

        .display {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px 20px;
            text-align: right;
            border-radius: 20px 20px 0 0;
        }

        .display-result {
            font-size: 2.5rem;
            font-weight: 300;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            word-break: break-all;
            margin-bottom: 10px;
        }

        .display-operation {
            font-size: 1rem;
            opacity: 0.7;
            min-height: 20px;
        }

        .btn-calculator {
            height: 70px;
            font-size: 1.3rem;
            font-weight: 500;
            border: none;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-calculator:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-calculator:active {
            transform: translateY(0);
        }

        .btn-number {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #495057;
        }

        .btn-number:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            color: #495057;
        }

        .btn-operator {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-operator:hover {
            background: linear-gradient(135deg, #ee5a52, #dc3545);
            color: white;
        }

        .btn-equals {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
        }

        .btn-equals:hover {
            background: linear-gradient(135deg, #40c057, #37b24d);
            color: white;
        }

        .btn-clear {
            background: linear-gradient(135deg, #ffd43b, #fab005);
            color: #495057;
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #fab005, #f59f00);
            color: #495057;
        }

        .error-message {
            color: #ff6b6b;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .error-message.show {
            opacity: 1;
        }

        .calculator-title {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 576px) {
            .calculator-container {
                margin: 20px;
                max-width: none;
            }
            
            .display-result {
                font-size: 2rem;
            }
            
            .btn-calculator {
                height: 60px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="calculator-title">Advanced Calculator</h1>
        
        <div class="calculator-container">
            <!-- Display Section -->
            <div class="display">
                <div class="display-operation" id="operation-display"></div>
                <div class="display-result" id="result-display">0</div>
            </div>
            
            <!-- Error Message -->
            <div class="error-message" id="error-message"></div>
            
            <!-- Calculator Buttons -->
            <div class="p-3">
                <div class="row g-2">
                    <!-- First Row -->
                    <div class="col-6">
                        <button type="button" class="btn btn-calculator btn-clear w-100" onclick="clearAll()">
                            Clear
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-clear w-100" onclick="deleteLast()">
                            ⌫
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-operator w-100" onclick="inputOperator('/')">
                            ÷
                        </button>
                    </div>
                    
                    <!-- Second Row -->
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('7')">
                            7
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('8')">
                            8
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('9')">
                            9
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-operator w-100" onclick="inputOperator('*')">
                            ×
                        </button>
                    </div>
                    
                    <!-- Third Row -->
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('4')">
                            4
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('5')">
                            5
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('6')">
                            6
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-operator w-100" onclick="inputOperator('-')">
                            −
                        </button>
                    </div>
                    
                    <!-- Fourth Row -->
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('1')">
                            1
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('2')">
                            2
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('3')">
                            3
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-operator w-100" onclick="inputOperator('+')">
                            +
                        </button>
                    </div>
                    
                    <!-- Fifth Row -->
                    <div class="col-6">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputNumber('0')">
                            0
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-number w-100" onclick="inputDecimal()">
                            .
                        </button>
                    </div>
                    <div class="col-3">
                        <button type="button" class="btn btn-calculator btn-equals w-100" onclick="calculate()">
                            =
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Section -->
        <div class="calculator-container mt-4">
            <div class="p-4">
                <h5 class="text-center mb-3" style="color: #495057;">Calculation History</h5>
                <div id="history-list" style="max-height: 200px; overflow-y: auto;">
                    <p class="text-muted text-center">No calculations yet</p>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-sm w-100 mt-3" onclick="clearHistory()">
                    Clear History
                </button>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Calculator Logic -->
    <script>
        // Calculator state
        let currentInput = '0';
        let operator = null;
        let previousInput = null;
        let shouldResetDisplay = false;
        let calculationHistory = [];

        // DOM elements
        const resultDisplay = document.getElementById('result-display');
        const operationDisplay = document.getElementById('operation-display');
        const errorMessage = document.getElementById('error-message');
        const historyList = document.getElementById('history-list');

        // Backend-like calculation service
        class CalculationService {
            static add(a, b) {
                return a + b;
            }

            static subtract(a, b) {
                return a - b;
            }

            static multiply(a, b) {
                return a * b;
            }

            static divide(a, b) {
                if (b === 0) {
                    throw new Error('Division by zero is not allowed');
                }
                return a / b;
            }

            static processCalculation(operation) {
                const { num1, num2, operator } = operation;
                
                try {
                    let result;
                    switch (operator) {
                        case '+':
                            result = this.add(num1, num2);
                            break;
                        case '-':
                            result = this.subtract(num1, num2);
                            break;
                        case '*':
                            result = this.multiply(num1, num2);
                            break;
                        case '/':
                            result = this.divide(num1, num2);
                            break;
                        default:
                            throw new Error('Invalid operator');
                    }
                    
                    return {
                        success: true,
                        result: result,
                        operation: `${num1} ${this.getOperatorSymbol(operator)} ${num2} = ${result}`
                    };
                } catch (error) {
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }

            static getOperatorSymbol(operator) {
                const symbols = {
                    '+': '+',
                    '-': '−',
                    '*': '×',
                    '/': '÷'
                };
                return symbols[operator] || operator;
            }

            static formatNumber(num) {
                if (num === null || num === undefined) return '0';
                
                // Handle very large or very small numbers
                if (Math.abs(num) > 999999999999 || (Math.abs(num) < 0.000001 && num !== 0)) {
                    return num.toExponential(6);
                }
                
                // Format with appropriate decimal places
                if (num % 1 === 0) {
                    return num.toString();
                } else {
                    return parseFloat(num.toFixed(10)).toString();
                }
            }
        }

        // Input handling functions
        function inputNumber(num) {
            hideError();
            
            if (shouldResetDisplay) {
                currentInput = num;
                shouldResetDisplay = false;
            } else {
                currentInput = currentInput === '0' ? num : currentInput + num;
            }
            
            updateDisplay();
        }

        function inputDecimal() {
            hideError();
            
            if (shouldResetDisplay) {
                currentInput = '0.';
                shouldResetDisplay = false;
            } else if (currentInput.indexOf('.') === -1) {
                currentInput += '.';
            }
            
            updateDisplay();
        }

        function inputOperator(op) {
            hideError();
            
            if (operator !== null && !shouldResetDisplay) {
                calculate();
            }
            
            previousInput = parseFloat(currentInput);
            operator = op;
            shouldResetDisplay = true;
            
            updateOperationDisplay();
        }

        function calculate() {
            if (operator === null || previousInput === null) {
                return;
            }
            
            const num1 = previousInput;
            const num2 = parseFloat(currentInput);
            
            // Use our backend-like service
            const response = CalculationService.processCalculation({
                num1: num1,
                num2: num2,
                operator: operator
            });
            
            if (response.success) {
                currentInput = CalculationService.formatNumber(response.result);
                addToHistory(response.operation);
                
                // Reset state
                operator = null;
                previousInput = null;
                shouldResetDisplay = true;
                
                updateDisplay();
                clearOperationDisplay();
            } else {
                showError(response.error);
            }
        }

        function clearAll() {
            currentInput = '0';
            operator = null;
            previousInput = null;
            shouldResetDisplay = false;
            
            updateDisplay();
            clearOperationDisplay();
            hideError();
        }

        function deleteLast() {
            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0';
            }
            
            updateDisplay();
            hideError();
        }

        // Display functions
        function updateDisplay() {
            resultDisplay.textContent = currentInput;
        }

        function updateOperationDisplay() {
            if (operator && previousInput !== null) {
                const operatorSymbol = CalculationService.getOperatorSymbol(operator);
                operationDisplay.textContent = `${CalculationService.formatNumber(previousInput)} ${operatorSymbol}`;
            }
        }

        function clearOperationDisplay() {
            operationDisplay.textContent = '';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            
            setTimeout(() => {
                hideError();
            }, 3000);
        }

        function hideError() {
            errorMessage.classList.remove('show');
        }

        // History functions
        function addToHistory(operation) {
            calculationHistory.unshift(operation);
            
            // Keep only last 10 calculations
            if (calculationHistory.length > 10) {
                calculationHistory = calculationHistory.slice(0, 10);
            }
            
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<p class="text-muted text-center">No calculations yet</p>';
            } else {
                historyList.innerHTML = calculationHistory
                    .map(operation => `<div class="border-bottom pb-2 mb-2 text-center">${operation}</div>`)
                    .join('');
            }
        }

        function clearHistory() {
            calculationHistory = [];
            updateHistoryDisplay();
        }

        // Keyboard support
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            
            if (key >= '0' && key <= '9') {
                inputNumber(key);
            } else if (key === '.') {
                inputDecimal();
            } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                inputOperator(key);
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculate();
            } else if (key === 'Escape' || key === 'c' || key === 'C') {
                clearAll();
            } else if (key === 'Backspace') {
                deleteLast();
            }
        });

        // Initialize display
        updateDisplay();
    </script>
</body>
</html>